<!--
  ~ Copyright 2011 Leonid Maslov<leonidms@gmail.com>
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <resource type="i18n" name="i18n" location="i18n/messages"/>

    <rest key="runner-output" name="REST Cli API" path="/rest-scripting" version="1.0"
          description="Provides REST CLI endpoints for ${project.name}.">
        <package>com.blogspot.leonardinius.rest</package>
    </rest>

    <component key="script-service"
               name="Script Service"
               public="true"
               interface="com.blogspot.leonardinius.api.ScriptService"
               class="com.blogspot.leonardinius.api.impl.ScriptServiceImpl">
        <description>Provides script registration capabilities on top of javax.script.ScriptEngineManager</description>
    </component>
    <component key="cli-session-manager" name="Script Service" public="false"
               interface="com.blogspot.leonardinius.api.ScriptSessionManager"
               class="com.blogspot.leonardinius.api.impl.ScriptSessionManagerImpl">
        <description>Implements CLI session management</description>
    </component>
    <component key="rhino-registrar" name="Rhino Registrar" public="false"
               interface="com.blogspot.leonardinius.api.Registrar"
               class="com.blogspot.leonardinius.api.impl.RhinoRegistrarImpl">
        <description>Provides Javascript Rhino (bundled with Sun/Oracle JDK)</description>
    </component>

    <web-resource key="cli-js-css" name="jquery-console javascript and css resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <resource type="download" name="cli.css" location="cli/cli.css">
            <property key="content-type" value="text/css"/>
            <property key="charset" value="utf-8"/>
        </resource>

        <resource type="download" name="jquery.console.js" location="jquery-console/jquery.console.js">
            <property key="content-type" value="text/javascript"/>
            <property key="charset" value="utf-8"/>
        </resource>
        <resource type="download" name="cli.js" location="cli/cli.js">
            <property key="content-type" value="text/javascript"/>
            <property key="charset" value="utf-8"/>
        </resource>
    </web-resource>

    <webwork1 key="cli-actions" name="CLI Webwork Action" class="java.lang.Object">
        <actions>
            <action name="com.blogspot.leonardinius.actions.ScriptRunnerAction"
                    alias="restCli">
                <view name="exec">/templates/exec-input.vm</view>
                <view name="list">/templates/cli-list.vm</view>
                <view name="cli">/templates/cli-input.vm</view>
            </action>
        </actions>
    </webwork1>

    <web-section key="cli-web-section" name="CLI Section" location="system.admin"
                 system="true" weight="101">
        <label key="cli.web.section.title"/>
        <conditions type="OR">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsSysAdminCondition"/>
        </conditions>
    </web-section>

    <web-item key="exec-runner-web-item" name="Script executor" section="system.admin/cli-web-section"
              weight="20">
        <label key="cli.web.section.runner_link"/>
        <link linkId="rest_exec_runner">/secure/admin/restCli!exec.jspa?atl_token=${atl_token}</link>
        <conditions type="OR">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsSysAdminCondition"/>
        </conditions>
    </web-item>

    <web-item key="cli-runner-web-item" name="Script CLI" section="system.admin/cli-web-section"
              weight="10">
        <label key="cli.web.section.cli_link"/>
        <link linkId="rest_cli_runner">/secure/admin/restCli!list.jspa?atl_token=${atl_token}</link>
        <conditions type="OR">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserIsSysAdminCondition"/>
        </conditions>
    </web-item>
</atlassian-plugin>